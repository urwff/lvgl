cmake_minimum_required(VERSION 3.10)

# é¡¹ç›®ä¸æ ‡å‡†
project(smart_home C)
set(CMAKE_C_STANDARD 99)

# æ„å»ºç±»å‹ï¼šé»˜è®¤ Release
if(NOT CMAKE_BUILD_TYPE)
  set(CMAKE_BUILD_TYPE Release CACHE STRING "Build type" FORCE)
endif()

# æç¤ºä¿¡æ¯ï¼ˆé¿å…ä½¿ç”¨æ–°ç‰ˆæœ¬ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼‰
message(STATUS "[smart_home] Project: ${PROJECT_NAME}")
message(STATUS "[smart_home] Build type: ${CMAKE_BUILD_TYPE}")
message(STATUS "[smart_home] C compiler: ${CMAKE_C_COMPILER}")

# LVGL é…ç½®ï¼ˆç®€åŒ–åŒ…å«ï¼‰ä¸ lv_conf.h è·¯å¾„
add_definitions(-DLV_CONF_INCLUDE_SIMPLE)
set(LV_BUILD_CONF_PATH ${CMAKE_SOURCE_DIR}/config/lv_conf.h)

# æ”¶é›†åº”ç”¨æºç 
file(GLOB_RECURSE APP_SRC
  ${CMAKE_SOURCE_DIR}/src/*.c
  ${CMAKE_SOURCE_DIR}/src/core/*.c
  ${CMAKE_SOURCE_DIR}/src/service/*.c
  ${CMAKE_SOURCE_DIR}/src/ui/*.c
  ${CMAKE_SOURCE_DIR}/src/ui/components/*.c
  ${CMAKE_SOURCE_DIR}/src/ui/pages/*.c
  ${CMAKE_SOURCE_DIR}/src/utils/*.c
)

# ç›´æ¥æ”¶é›† LVGL æºç ï¼ˆé¿å… add_subdirectory å¯¹ CMake ç‰ˆæœ¬çš„è¦æ±‚ï¼‰
file(GLOB_RECURSE LVGL_SRC
  ${CMAKE_SOURCE_DIR}/libs/lvgl/src/*.c
)

# ç›®æ ‡
add_executable(smart_home_ui
  ${APP_SRC}
  ${LVGL_SRC}
)

# å¤´æ–‡ä»¶è·¯å¾„
target_include_directories(smart_home_ui PRIVATE
  ${CMAKE_SOURCE_DIR}
  ${CMAKE_SOURCE_DIR}/src
  ${CMAKE_SOURCE_DIR}/libs
  ${CMAKE_SOURCE_DIR}/libs/lvgl
)

# ç¼–è¯‘ä¸é“¾æ¥é€‰é¡¹
target_compile_options(smart_home_ui PRIVATE -Wall)
# å¦‚éœ€ä½“ç§¯ä¼˜åŒ–å†æ‰“å¼€ï¼š
# target_compile_options(smart_home_ui PRIVATE -Os -ffunction-sections -fdata-sections)
# target_link_libraries éœ€æ”¾åœ¨ç›®æ ‡å
target_link_libraries(smart_home_ui m pthread)

# å‹å¥½æç¤ºï¼ˆé¿å…ä½¿ç”¨æ–°å¼ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼‰
add_custom_command(TARGET smart_home_ui POST_BUILD
  COMMAND ${CMAKE_COMMAND} -E echo ""
  COMMAND ${CMAKE_COMMAND} -E echo "âœ… æ„å»ºå®Œæˆ: $<TARGET_FILE:smart_home_ui>"
  COMMAND ${CMAKE_COMMAND} -E echo "ğŸ’¡ éƒ¨ç½²: scp $<TARGET_FILE:smart_home_ui> root@<board_ip>:/root/"
  COMMAND ${CMAKE_COMMAND} -E echo "â–¶ï¸  è¿è¡Œ: ./smart_home_ui"
)